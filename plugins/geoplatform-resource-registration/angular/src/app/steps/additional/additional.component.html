<mat-card>

    <mat-card-subtitle>
        Optionally, specify additional information to help better describe your
        resource and to aid others in discovering it.
    </mat-card-subtitle>


    <form [formGroup]="formGroup">

        <div class="additional__container">

            <div class="additional__section">

                <mat-form-field floatLabel="always">
                    <mat-label>Keywords</mat-label>
                    <mat-chip-list #keyChipList>
                        <mat-chip
                            *ngFor="let key of keywords"
                            [selectable]="true"
                            [removable]="true"
                            (removed)="removeKeyword(key)">
                            {{key}}
                            <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                        <input matInput #keywordsInput
                            formControlName="$keywords"
                            [matChipInputFor]="keyChipList"
                            (matChipInputTokenEnd)="addKeyword($event)">
                    </mat-chip-list>
                    <mat-hint>Press 'ENTER' to add each keyword</mat-hint>
                </mat-form-field>


                <gprr-autocomplete-mat-chip
                    [label]="'Communities'"
                    [placeholder]="'Associate communities'"
                    [hint]="'Find communities using the typeahead and select them to associate'"
                    [fieldName]="'usedBy'"
                    [formGroup]="formGroup"
                    [filterFn]="filterCommunities">
                </gprr-autocomplete-mat-chip>

                <!-- Thumbnail -->
                <div>
                    <div class="u-text--sm t-text--bold t-fg--gray-md">Thumbnail</div>
                    <div class="thumbnail__container">
                        <div class="thumbnail__form">
                            <div class="d-flex">
                                <!-- File Upload -->
                                <div>
                                    <input type="file" accept="image/*" style="display:none"
                                        #thumbFileInput (change)="onFileUpload()">
                                    <input type="hidden" formControlName="thumbnailContent">
                                    <button mat-raised-button (click)="triggerFileUpload()">
                                        <mat-icon>image</mat-icon> Use a File
                                    </button>
                                    <span *ngIf="thumbFileInput.nativeElement?.files?.length">
                                        {{thumbFileInput.nativeElement?.files[0].name}}
                                    </span>
                                </div>

                                <!-- URL -->
                                <div class="flex-1 u-mg-left--md">
                                    <mat-form-field floatLabel="always">
                                        <mat-label>Use URL</mat-label>
                                        <mat-icon matPrefix>link</mat-icon>
                                        <input type="url" matInput
                                            formControlName="thumbnailUrl"
                                            (keyup)="onThumbnailUrlChange($event)"
                                            placeholder="Specify a thumbnail image">
                                        <mat-hint>Specify the URL of an image to use as the thumbnail of the resource</mat-hint>
                                        <mat-error *ngIf="isInvalid('thumbnailUrl')">{{getErrorMessage('thumbnailUrl')}}</mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                            <mat-error *ngIf="thumbError" class="u-mg-left--md u-text--sm">
                                {{thumbError}}.
                                <button type="button" class="btn btn-sm btn-danger"
                                    (click)="thumbError=null;">dismiss</button>
                            </mat-error>

                        </div>
                        <div class="thumbnail__preview" *ngIf="hasValue('thumbnailUrl')||hasValue('thumbnailContent')">
                            <div class="u-text--sm t-text--bold t-fg--gray-md">Selected Thumbnail</div>
                            <img *ngIf="hasValue('thumbnailUrl')"
                                [src]="getValue('thumbnailUrl')">
                            <img *ngIf="hasValue('thumbnailContent')"
                                [src]="'data:image/png;base64,'+getValue('thumbnailContent')">
                        </div>
                    </div>
                </div>



            </div>

        </div>

        <div class="m-message m-message--error" *ngIf="hasError">
            <div class="m-message__heading">
                <mat-icon class="m-message__icon">error</mat-icon>
                {{hasError.label||"An Error Occurred"}}
            </div>
            <div class="m-message__body">
                {{hasError.message||"Something unexpected happened and an unknonwn error has occurred."}}
            </div>
        </div>

    </form>


    <mat-card-actions>
        <div class="m-step__buttons">
            <button mat-raised-button matStepperPrevious class="nav-btn">Back</button>
            <button mat-raised-button color="primary" matStepperNext
                [disabled]="formGroup.invalid || !data.createdBy">Continue</button>
        </div>
    </mat-card-actions>

</mat-card>
